<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Aeolus</title>
    <description>Aeolus|Look The World</description>
    <link>http://Aeolus-dan.github.io/</link>
    <atom:link href="http://Aeolus-dan.github.io/feed.xml" rel="self" type="application/rss+xml" />
    <pubDate>Fri, 14 Apr 2017 09:25:26 +0000</pubDate>
    <lastBuildDate>Fri, 14 Apr 2017 09:25:26 +0000</lastBuildDate>
    <generator>Jekyll v3.2.1</generator>
    
      <item>
        <title>Jack 编译器对混淆lambda代码的影响</title>
        <description>&lt;h1 id=&quot;section&quot;&gt;起因 :&lt;/h1&gt;
&lt;p&gt;Jack 是 Java Android Compiler Kit 的缩写，它可以将 Java 代码直接编译为 Dalvik 字节码，并负责 Minification, Obfuscation, Repackaging, Multidexing, Incremental compilation。它试图取代 javac/dx/proguard/jarjar/multidex 库等工具。&lt;/p&gt;

&lt;p&gt;&lt;br /&gt;&lt;br /&gt;
Android studio从2.2开始支持Java8的部分新特性。也就意味着终于可以用上官方的lambda, 但是问题来了…&lt;/p&gt;

&lt;p&gt;在Android studio 中使用Java8, 可以通过如下配置&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;
 android{
       ...
        compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
        defaultConfig {
             ...
         jackOptions {
             enabled true
          }
      }
        ...
 }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;在一切配置完成后就可以愉快的使用lambda来缩短代码量。&lt;/p&gt;

&lt;p&gt;But。。。。。。。&lt;/p&gt;

&lt;p&gt;当项目完成时对代码进行混淆时出现了
    11-15 01:46:26.818: W/System.err(21810): java.lang.RuntimeException: Missing type parameter.
    11-15 01:46:26.828: W/System.err(21810):    at da.&lt;init&gt;(Unknown Source)
    11-15 01:46:26.828: W/System.err(21810):    at gc.&lt;init&gt;(Unknown Source)
    11-15 01:46:26.828: W/System.err(21810):    at fx.f(Unknown Source)
    11-15 01:46:26.828: W/System.err(21810):    at com.yourshows.activity.UnwatchedActivity.onResume(Unknown Source)&lt;/init&gt;&lt;/init&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h1 id=&quot;section-1&quot;&gt;解决：&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;看到这个错误是一脸懵逼啊。。&lt;br /&gt;没办法决定先查看/build/outputs/mapping/mapping.txt文件下的映射关系
 com.google.gson.reflect.TypeToken -&amp;gt; da:
经过一番折腾在网上找到了相关解决方法：&lt;br /&gt;
  在混淆文件中加入对GSON的混淆&lt;br /&gt;&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;
    # Gson uses generic type information stored in a class file when working with fields. Proguard&lt;br /&gt;
    # removes such information by default, so configure it to keep all of it.&lt;br /&gt;
    -keepattributes Signature&lt;br /&gt;

    # Gson specific classes&lt;br /&gt;
    -keep class sun.misc.Unsafe { *; }&lt;br /&gt;
    #-keep class com.google.gson.stream.** { *; }&lt;br /&gt;

    # Application classes that will be serialized/deserialized over Gson&lt;br /&gt;
    -keep class com.google.gson.examples.android.model.** { *; }&lt;br /&gt;
    -keep class com.google.gson.** {*;}&lt;br /&gt;
    -keep class org.json.** {*;}&lt;br /&gt;
    -keepattributes *Annotation*&lt;br /&gt;
    -keep class * implements com.google.gson.TypeAdapterFactory&lt;br /&gt;
    -keep class * implements com.google.gson.JsonSerializer&lt;br /&gt;
    -keep class * implements com.google.gson.JsonDeserializer&lt;br /&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;满心欣喜的以为解决了问题, 可是这只是自己的期盼。 在看到程序崩溃的时候，心情低落到了低谷.&lt;/p&gt;

&lt;p&gt;2.灵光一闪,想起之前在官方未支持lambda时,一直使用retrolambda,混淆时没有出现这些问题.这时就想难道是新编译器的问题. 接着找应该保留的类，在这期间，保留了java.lang.invoke包下的所有类，但是都没有解决。不得已只能使用retrolambda了, &lt;br /&gt;
    然后这个问题就被规避了.&lt;br /&gt;&lt;br /&gt;
    &lt;strong&gt;记得将enable 设为false。 不然会与retrolambda 冲突. 针对于支持Jack编译器的studio&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;使用Jack时还可能在使用&lt;code class=&quot;highlighter-rouge&quot;&gt;shrinkResources true&lt;/code&gt;时出现:&lt;br /&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt; Error:A problem was found with the configuration of task ':app:packageBaiduRelease'.
File 'F:\myjob\github\Android-architecture-todo-mvp-rxjava\MVP\app\build\intermediates\res\resources-baidu-release-stripped.ap_' specified for property 'resourceFile' does not exist.&lt;/code&gt;&lt;/pre&gt;

</description>
        <pubDate>Fri, 14 Apr 2017 00:00:00 +0000</pubDate>
        <link>http://Aeolus-dan.github.io/bog/2017/04/14/Jack%E7%BC%96%E8%AF%91%E5%99%A8%E5%AF%B9%E4%BD%BF%E7%94%A8Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%81%9A%E6%B7%B7%E6%B7%86%E7%9A%84%E5%9D%91/</link>
        <guid isPermaLink="true">http://Aeolus-dan.github.io/bog/2017/04/14/Jack%E7%BC%96%E8%AF%91%E5%99%A8%E5%AF%B9%E4%BD%BF%E7%94%A8Lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%81%9A%E6%B7%B7%E6%B7%86%E7%9A%84%E5%9D%91/</guid>
        
        <category>Android</category>
        
        <category>Jack</category>
        
        
        <category>bog</category>
        
      </item>
    
  </channel>
</rss>
